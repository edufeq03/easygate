{% extends 'base.html' %}

{% block title %}Consulta de Profissional{% endblock %}

{% block content %}
    <h1 class="mt-4">Consulta de Profissional</h1>
    <p class="lead">Busque um profissional pelo nome, CPF ou placa do veículo.</p>
    
    <div class="row">
        <div class="col-md-12 mb-4">
            <form action="{{ url_for('porteiro.consultar_profissional') }}" method="GET" class="input-group">
                <input type="text" name="query" class="form-control" placeholder="Buscar por nome, CPF ou placa" value="{{ query }}">
                <button class="btn btn-primary" type="submit">Buscar</button>
            </form>
        </div>
    </div>
    
    {% if query %}
        <hr>
        {% if profissionais_encontrados %}
            {% for profissional in profissionais_encontrados %}
                <div class="card mb-3 shadow-sm">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Profissional Encontrado: {{ profissional.nome }}</h5>
                        <small>CPF: {{ profissional.cpf }} | Placa: {{ profissional.placa_veiculo if profissional.placa_veiculo else 'N/A' }}</small>
                    </div>
                    <div class="card-body">
                        <form action="{{ url_for('porteiro.consultar_profissional') }}" method="POST">
                            <input type="hidden" name="profissional_id" value="{{ profissional.id }}">
                            <input type="hidden" name="query" value="{{ query }}">
                            
                            {{ form_acesso_direto.hidden_tag() }}
                            
                            <div class="mb-3">
                                {{ form_acesso_direto.servico.label(class="form-label") }}
                                {{ form_acesso_direto.servico(class="form-control") }}
                            </div>

                            <div class="mb-3">
                                {{ form_acesso_direto.morador_id.label(class="form-label") }}
                                <select name="morador_id" class="form-control" required>
                                    <option value="" selected disabled>Selecione um morador</option>
                                    {% for morador in moradores_condominio %}
                                    <option value="{{ morador.id }}">{{ morador.nome }} (Apto: {{ morador.apartamento }})</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-success mt-3">Registrar Entrada</button>
                        </form>

                    </div>
                </div>
            {% endfor %}
        {% elif form_cadastro %}
            <div class="alert alert-info">
                Profissional não encontrado. Por favor, cadastre-o para registrar o acesso.
            </div>
            
            <div class="card shadow mt-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Novo Cadastro</h5>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('porteiro.cadastrar_profissional') }}" method="POST">
                        {{ form_cadastro.hidden_tag() }}
                        
                        {% if acesso_id %}
                        <input type="hidden" name="acesso_id" value="{{ acesso_id }}">
                        {% endif %}

                        <div class="mb-3">
                            {{ form_cadastro.nome.label(class="form-label") }}
                            {{ form_cadastro.nome(class="form-control") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form_cadastro.cpf.label(class="form-label") }}
                            {{ form_cadastro.cpf(class="form-control") }}
                        </div>
                        
                        <div class="mb-3">
                            {{ form_cadastro.placa_veiculo.label(class="form-label") }}
                            {{ form_cadastro.placa_veiculo(class="form-control") }}
                        </div>

                        <div class="mb-3">
                            {{ form_cadastro.empresa.label(class="form-label") }}
                            {{ form_cadastro.empresa(class="form-control") }}
                        </div>
                        
                        {{ form_cadastro.submit(class="btn btn-primary mt-3") }}
                    </form>
                </div>
            </div>
        {% endif %}
    {% else %}
        <div class="alert alert-info mt-4">
            Digite um nome, CPF ou placa de veículo para iniciar a busca.
        </div>
    {% endif %}
{% endblock %}